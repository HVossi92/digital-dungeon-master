<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Dungeon Master</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #1a1a1a;
            --bg-panel: #2a2a2a;
            --accent-gold: #c9a66b;
            --accent-red: #8a2a2a;
            --text-light: #e0e0e0;
            --border-ornate: #8a6d3b;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
            height: 100vh;
            overflow: hidden;
        }

        .game-container {
            height: 100vh;
            padding: 10px;
        }

        .panel {
            background-color: var(--bg-panel);
            border: 2px solid var(--border-ornate);
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
        }

        .panel-header {
            background-color: rgba(42, 28, 23, 0.8);
            color: var(--accent-gold);
            padding: 5px 10px;
            font-weight: bold;
            text-align: center;
            border-bottom: 1px solid var(--border-ornate);
        }

        .scene-panel {
            height: 30vh;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .scene-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            font-style: italic;
        }

        .character-panel,
        .enemy-panel {
            height: 68vh;
        }

        .chat-panel {
            height: 68vh;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
            background: rgba(26, 26, 26, 0.7);
        }

        .chat-input {
            padding: 10px;
            background: rgba(42, 28, 23, 0.8);
            border-top: 1px solid var(--border-ornate);
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 5px;
            max-width: 80%;
        }

        .message-dm {
            background-color: rgba(138, 42, 42, 0.3);
            border-left: 3px solid var(--accent-red);
            align-self: flex-start;
        }

        .message-player {
            background-color: rgba(42, 42, 138, 0.3);
            border-left: 3px solid #2a2a8a;
            align-self: flex-end;
            margin-left: auto;
        }

        .character-image,
        .enemy-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            border-bottom: 1px solid var(--border-ornate);
        }

        .character-stats,
        .enemy-stats {
            padding: 10px;
        }

        .stat-bar {
            height: 15px;
            margin-bottom: 10px;
            border-radius: 7px;
            overflow: hidden;
            background-color: #444;
        }

        .stat-fill {
            height: 100%;
            border-radius: 7px;
        }

        .health-fill {
            background: linear-gradient(90deg, #8a2a2a, #c83232);
        }

        .mana-fill {
            background: linear-gradient(90deg, #2a2a8a, #3232c8);
        }

        .stamina-fill {
            background: linear-gradient(90deg, #8a8a2a, #c8c832);
        }

        .stat-value {
            font-size: 0.8rem;
            text-align: right;
            margin-top: -25px;
            padding-right: 5px;
            color: white;
            text-shadow: 1px 1px 1px black;
        }

        .abilities {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 15px;
        }

        .ability-btn {
            background-color: rgba(42, 28, 23, 0.8);
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ability-btn:hover {
            background-color: var(--accent-gold);
            color: #2a1c17;
        }

        .inventory-section,
        .effects-section {
            margin-top: 15px;
            border-top: 1px solid rgba(138, 109, 59, 0.5);
            padding-top: 10px;
        }

        .inventory-item,
        .status-effect {
            display: inline-block;
            width: 40px;
            height: 40px;
            background-color: rgba(42, 28, 23, 0.8);
            border: 1px solid var(--accent-gold);
            border-radius: 3px;
            margin: 2px;
            position: relative;
            cursor: pointer;
        }

        .item-icon,
        .effect-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: var(--accent-gold);
        }

        .dice-section {
            margin-top: 10px;
            text-align: center;
        }

        .dice {
            display: inline-block;
            width: 40px;
            height: 40px;
            background-color: rgba(42, 28, 23, 0.8);
            border: 1px solid var(--accent-gold);
            border-radius: 5px;
            margin: 0 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: var(--accent-gold);
            cursor: pointer;
        }

        .dice:hover {
            background-color: var(--accent-gold);
            color: #2a1c17;
        }

        .game-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }

        .control-btn {
            background-color: rgba(42, 28, 23, 0.8);
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin-left: 5px;
            cursor: pointer;
        }

        .control-btn:hover {
            background-color: var(--accent-gold);
            color: #2a1c17;
        }

        /* Ornate corners for panels */
        .panel::after {
            content: "";
            position: absolute;
            width: 15px;
            height: 15px;
            border: 2px solid var(--accent-gold);
            border-radius: 0;
        }

        .panel-corner-tl::after {
            top: -2px;
            left: -2px;
            border-right: none;
            border-bottom: none;
        }

        .panel-corner-tr::after {
            top: -2px;
            right: -2px;
            border-left: none;
            border-bottom: none;
        }

        .panel-corner-bl::after {
            bottom: -2px;
            left: -2px;
            border-right: none;
            border-top: none;
        }

        .panel-corner-br::after {
            bottom: -2px;
            right: -2px;
            border-left: none;
            border-top: none;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <div class="game-controls">
            <div class="control-btn" title="Settings">
                <i class="fas fa-cog"></i>
            </div>
            <div class="control-btn" title="Save Game">
                <i class="fas fa-save"></i>
            </div>
            <div class="control-btn" title="Journal">
                <i class="fas fa-book"></i>
            </div>
            <div class="control-btn" title="Help">
                <i class="fas fa-question"></i>
            </div>
        </div>

        <div class="row g-2 mb-2">
            <div class="col-12">
                <!-- Scene Panel -->
                <div class="panel scene-panel panel-corner-tl panel-corner-tr panel-corner-bl panel-corner-br"
                    style="background-image: url('/placeholder.svg?height=400&width=800');" hx-get="/api/scene"
                    hx-trigger="load, sceneChange from:body" hx-swap="outerHTML">
                    <div class="panel-header">The Forgotten Ruins</div>
                    <div class="scene-overlay">
                        Ancient stone columns rise from the mist, their surfaces etched with mysterious runes that glow
                        with a faint blue light.
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-2">
            <div class="col-md-3">
                <!-- Character Panel -->
                <div class="panel character-panel panel-corner-tl panel-corner-tr panel-corner-bl panel-corner-br"
                    hx-get="/api/character" hx-trigger="load, characterUpdate from:body" hx-swap="innerHTML">
                    <div class="panel-header">Character</div>
                    <div class="character-image"
                        style="background-image: url('/placeholder.svg?height=200&width=200');"></div>
                    <div class="character-stats">
                        <h5>Thorne Ironheart</h5>
                        <div>Level 5 Dwarf Paladin</div>

                        <div class="mt-3">Health</div>
                        <div class="stat-bar">
                            <div class="stat-fill health-fill" style="width: 75%;"></div>
                            <div class="stat-value">75/100</div>
                        </div>

                        <div>Mana</div>
                        <div class="stat-bar">
                            <div class="stat-fill mana-fill" style="width: 60%;"></div>
                            <div class="stat-value">30/50</div>
                        </div>

                        <div>Stamina</div>
                        <div class="stat-bar">
                            <div class="stat-fill stamina-fill" style="width: 90%;"></div>
                            <div class="stat-value">45/50</div>
                        </div>

                        <div class="mt-3">
                            <div class="row">
                                <div class="col-6">STR: 16 (+3)</div>
                                <div class="col-6">DEX: 12 (+1)</div>
                                <div class="col-6">CON: 15 (+2)</div>
                                <div class="col-6">INT: 10 (+0)</div>
                                <div class="col-6">WIS: 14 (+2)</div>
                                <div class="col-6">CHA: 13 (+1)</div>
                            </div>
                        </div>

                        <div class="abilities">
                            <div class="ability-btn" hx-post="/api/ability/smite" hx-trigger="click">Divine Smite</div>
                            <div class="ability-btn" hx-post="/api/ability/heal" hx-trigger="click">Lay on Hands</div>
                            <div class="ability-btn" hx-post="/api/ability/shield" hx-trigger="click">Shield of Faith
                            </div>
                        </div>

                        <div class="inventory-section">
                            <div>Inventory</div>
                            <div class="inventory-item" title="Health Potion">
                                <div class="item-icon"><i class="fas fa-flask text-danger"></i></div>
                            </div>
                            <div class="inventory-item" title="Mana Potion">
                                <div class="item-icon"><i class="fas fa-flask text-primary"></i></div>
                            </div>
                            <div class="inventory-item" title="Warhammer">
                                <div class="item-icon"><i class="fas fa-hammer"></i></div>
                            </div>
                            <div class="inventory-item" title="Shield">
                                <div class="item-icon"><i class="fas fa-shield-alt"></i></div>
                            </div>
                            <div class="inventory-item" title="Holy Symbol">
                                <div class="item-icon"><i class="fas fa-sun"></i></div>
                            </div>
                        </div>

                        <div class="effects-section">
                            <div>Status Effects</div>
                            <div class="status-effect" title="Blessed">
                                <div class="effect-icon"><i class="fas fa-pray"></i></div>
                            </div>
                            <div class="status-effect" title="Protected">
                                <div class="effect-icon"><i class="fas fa-shield-alt"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <!-- Chat Panel -->
                <div class="panel chat-panel panel-corner-tl panel-corner-tr panel-corner-bl panel-corner-br">
                    <div class="panel-header">Adventure Log</div>
                    <div class="chat-messages" id="chat-messages" hx-get="/api/messages"
                        hx-trigger="load, newMessage from:body" hx-swap="innerHTML">
                        <div class="message message-dm">
                            <strong>Dungeon Master:</strong> Welcome to the Forgotten Ruins. The ancient stones whisper
                            secrets of a civilization long past. What do you wish to do?
                        </div>
                        <div class="message message-player">
                            <strong>Thorne:</strong> I want to examine the glowing runes on the nearest column.
                        </div>
                        <div class="message message-dm">
                            <strong>Dungeon Master:</strong> As you approach the column, the runes pulse with arcane
                            energy. They appear to be in an ancient dwarven dialect. With your knowledge, you can make
                            out words related to "guardian" and "seal".
                        </div>
                        <div class="message message-player">
                            <strong>Thorne:</strong> I'll try to recall any legends about sealed guardians in these
                            ruins.
                        </div>
                        <div class="message message-dm">
                            <strong>Dungeon Master:</strong> Roll a History check.
                        </div>
                        <div class="message message-dm">
                            <em>Thorne rolls 14 + 2 = 16 for History</em>
                        </div>
                        <div class="message message-dm">
                            <strong>Dungeon Master:</strong> You recall tales of the Ironguard Sentinels, enchanted
                            constructs created by your ancestors to protect their most valuable treasures. Legend says
                            they still patrol forgotten dwarven ruins, awaiting the proper command to stand down.
                        </div>
                    </div>
                    <div class="chat-input">
                        <form hx-post="/api/send-message" hx-trigger="submit" hx-target="#chat-messages"
                            hx-swap="beforeend">
                            <div class="input-group">
                                <input type="text" name="message"
                                    class="form-control bg-dark text-light border-secondary"
                                    placeholder="What would you like to do?" aria-label="Message">
                                <button class="btn btn-outline-secondary" type="submit"
                                    style="color: var(--accent-gold); border-color: var(--accent-gold);">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>
                        <div class="dice-section mt-2">
                            <div class="dice" hx-post="/api/roll/d4" hx-trigger="click">d4</div>
                            <div class="dice" hx-post="/api/roll/d6" hx-trigger="click">d6</div>
                            <div class="dice" hx-post="/api/roll/d8" hx-trigger="click">d8</div>
                            <div class="dice" hx-post="/api/roll/d10" hx-trigger="click">d10</div>
                            <div class="dice" hx-post="/api/roll/d12" hx-trigger="click">d12</div>
                            <div class="dice" hx-post="/api/roll/d20" hx-trigger="click">d20</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <!-- Enemy Panel -->
                <div class="panel enemy-panel panel-corner-tl panel-corner-tr panel-corner-bl panel-corner-br"
                    hx-get="/api/enemy" hx-trigger="load, enemyUpdate from:body" hx-swap="innerHTML">
                    <div class="panel-header">Enemy</div>
                    <div class="enemy-image" style="background-image: url('/placeholder.svg?height=200&width=200');">
                    </div>
                    <div class="enemy-stats">
                        <h5>Iron Guardian</h5>
                        <div>Level 6 Construct</div>

                        <div class="mt-3">Health</div>
                        <div class="stat-bar">
                            <div class="stat-fill health-fill" style="width: 90%;"></div>
                            <div class="stat-value">135/150</div>
                        </div>

                        <div>Energy</div>
                        <div class="stat-bar">
                            <div class="stat-fill mana-fill" style="width: 100%;"></div>
                            <div class="stat-value">80/80</div>
                        </div>

                        <div class="mt-3">
                            <div>Armor Class: 18</div>
                            <div>Damage Resistance: Piercing, Slashing</div>
                            <div>Weakness: Lightning</div>
                        </div>

                        <div class="mt-3">
                            <div>Actions:</div>
                            <ul class="ps-3">
                                <li>Slam (2d8+4 bludgeoning)</li>
                                <li>Stone Projectile (1d10+2 bludgeoning)</li>
                                <li>Ground Pound (DC 15 DEX save)</li>
                            </ul>
                        </div>

                        <div class="effects-section">
                            <div>Status Effects</div>
                            <div class="status-effect" title="Arcane Shield">
                                <div class="effect-icon"><i class="fas fa-shield-alt text-primary"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-scroll chat to bottom
        function scrollChatToBottom() {
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Call on page load
        document.addEventListener('DOMContentLoaded', scrollChatToBottom);

        // Call when new messages are added
        document.body.addEventListener('htmx:afterSwap', function (event) {
            if (event.detail.target.id === 'chat-messages') {
                scrollChatToBottom();
            }
        });

        // Dice rolling animation
        document.addEventListener('click', function (event) {
            if (event.target.closest('.dice')) {
                const dice = event.target.closest('.dice');
                dice.classList.add('animate-dice');
                setTimeout(() => {
                    dice.classList.remove('animate-dice');
                }, 500);
            }
        });
    </script>
</body>

</html>